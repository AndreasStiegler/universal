(function () {

    "use strict";

    var fluid = require("infusion"),
        express = require("express"),
        gpii = fluid.registerNamespace("gpii");

    fluid.defaults("gpii.middleware", {
        gradeNames: ["autoInit", "fluid.eventedComponent"],
        preInitFunction: "gpii.middleware.preInit",
        nickName: "middleware",
        events: {
            onMiddleware: null
        },
        listeners: {
            onMiddleware: "{middleware}.onMiddlewareHandler"
        },
        invokers: {
            attachMiddleware: "gpii.middleware.attachMiddleware"
        }
    });

    gpii.middleware.preInit = function (that) {
        that.nickName = "middleware";
        that.onMiddlewareHandler = function (request) {
            that.attachMiddleware(request);
        };
    };

    fluid.defaults("gpii.middleware.bodyParser", {
        gradeNames: ["gpii.middleware", "autoInit"]
    });
    fluid.demands("gpii.middleware.attachMiddleware", "gpii.middleware.bodyParser", {
        funcName: "gpii.middleware.attachBodyParser",
        args: "{arguments}.0"
    });
    gpii.middleware.attachBodyParser = function (request) {
        var parser = express.bodyParser();
        parser(request.req, request.res, request.next);
    };

})();